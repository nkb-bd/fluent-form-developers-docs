<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Fluent ORM: Getting Started | FluentCRM Developers</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/assets/img/logo.svg" color="#7742e6">
    <link rel="apple-touch-icon" href="/assets/img/logo.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,300;0,500;0,700;1,300;1,500;1,700&amp;display=auto">
    <meta name="description" content="Resources and tutorials for FluentCRM developers">
    <meta name="theme-color" content="#7742e6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/img/icon.svg">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.d0afebfe.css" as="style"><link rel="preload" href="/assets/js/app.1cc69afb.js" as="script"><link rel="preload" href="/assets/js/4.50f88fe4.js" as="script"><link rel="preload" href="/assets/js/36.688cda3c.js" as="script"><link rel="preload" href="/assets/js/6.ad1ba60c.js" as="script"><link rel="preload" href="/assets/js/5.78087223.js" as="script"><link rel="prefetch" href="/assets/js/1.69405b5c.js"><link rel="prefetch" href="/assets/js/10.1cd0ad7f.js"><link rel="prefetch" href="/assets/js/11.f32c864f.js"><link rel="prefetch" href="/assets/js/12.08c75246.js"><link rel="prefetch" href="/assets/js/13.ee99093d.js"><link rel="prefetch" href="/assets/js/14.3a0a2a10.js"><link rel="prefetch" href="/assets/js/15.bde4bddd.js"><link rel="prefetch" href="/assets/js/16.312dfb3b.js"><link rel="prefetch" href="/assets/js/17.7e07a8cc.js"><link rel="prefetch" href="/assets/js/18.30e9f96a.js"><link rel="prefetch" href="/assets/js/19.9d721225.js"><link rel="prefetch" href="/assets/js/20.0810e773.js"><link rel="prefetch" href="/assets/js/21.a51f06d0.js"><link rel="prefetch" href="/assets/js/22.4b4f1731.js"><link rel="prefetch" href="/assets/js/23.093867ca.js"><link rel="prefetch" href="/assets/js/24.8a84dcde.js"><link rel="prefetch" href="/assets/js/25.3ac1d9da.js"><link rel="prefetch" href="/assets/js/26.cbb0ef4c.js"><link rel="prefetch" href="/assets/js/27.c16e90f9.js"><link rel="prefetch" href="/assets/js/28.79acb935.js"><link rel="prefetch" href="/assets/js/29.a2d57755.js"><link rel="prefetch" href="/assets/js/30.18800f35.js"><link rel="prefetch" href="/assets/js/31.2a59842a.js"><link rel="prefetch" href="/assets/js/32.60b55016.js"><link rel="prefetch" href="/assets/js/33.a94e688e.js"><link rel="prefetch" href="/assets/js/34.0ff54db3.js"><link rel="prefetch" href="/assets/js/35.19816c3d.js"><link rel="prefetch" href="/assets/js/37.e024b175.js"><link rel="prefetch" href="/assets/js/38.f05fa44e.js"><link rel="prefetch" href="/assets/js/39.737dd831.js"><link rel="prefetch" href="/assets/js/40.19b3e816.js"><link rel="prefetch" href="/assets/js/41.70cfbf57.js"><link rel="prefetch" href="/assets/js/42.fd0d0122.js"><link rel="prefetch" href="/assets/js/43.7205270f.js"><link rel="prefetch" href="/assets/js/44.fb0ba51f.js"><link rel="prefetch" href="/assets/js/45.27af2ab7.js"><link rel="prefetch" href="/assets/js/46.e6d2b375.js"><link rel="prefetch" href="/assets/js/47.a81764e1.js"><link rel="prefetch" href="/assets/js/48.f13b6329.js"><link rel="prefetch" href="/assets/js/49.fc10e579.js"><link rel="prefetch" href="/assets/js/50.80754d7e.js"><link rel="prefetch" href="/assets/js/51.7acb7f94.js"><link rel="prefetch" href="/assets/js/52.4fd8a6fc.js"><link rel="prefetch" href="/assets/js/53.dff9bdbe.js"><link rel="prefetch" href="/assets/js/54.12579f14.js"><link rel="prefetch" href="/assets/js/55.77553671.js"><link rel="prefetch" href="/assets/js/56.f938766a.js"><link rel="prefetch" href="/assets/js/57.ffab44b6.js"><link rel="prefetch" href="/assets/js/58.86afc0ff.js"><link rel="prefetch" href="/assets/js/59.556634ba.js"><link rel="prefetch" href="/assets/js/60.0ef6f2e4.js"><link rel="prefetch" href="/assets/js/61.a78d359c.js"><link rel="prefetch" href="/assets/js/62.fae5c1a8.js"><link rel="prefetch" href="/assets/js/63.9dc9086f.js"><link rel="prefetch" href="/assets/js/64.73cd7eb4.js"><link rel="prefetch" href="/assets/js/65.b19e28af.js"><link rel="prefetch" href="/assets/js/66.3a0df05f.js"><link rel="prefetch" href="/assets/js/67.83a70521.js"><link rel="prefetch" href="/assets/js/68.4fe511df.js"><link rel="prefetch" href="/assets/js/69.0d9d886a.js"><link rel="prefetch" href="/assets/js/7.3fc70b38.js"><link rel="prefetch" href="/assets/js/70.cb2ba26c.js"><link rel="prefetch" href="/assets/js/71.09bc5865.js"><link rel="prefetch" href="/assets/js/72.48fc84e2.js"><link rel="prefetch" href="/assets/js/73.04fef0ac.js"><link rel="prefetch" href="/assets/js/74.ea56a005.js"><link rel="prefetch" href="/assets/js/75.6c899132.js"><link rel="prefetch" href="/assets/js/76.12b268c1.js"><link rel="prefetch" href="/assets/js/77.aca7ddfa.js"><link rel="prefetch" href="/assets/js/78.46ada3cf.js"><link rel="prefetch" href="/assets/js/79.b5fa8919.js"><link rel="prefetch" href="/assets/js/8.a925eb1e.js"><link rel="prefetch" href="/assets/js/9.485e8673.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.d31fbf91.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d0afebfe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/icon.svg" alt="FluentCRM Developers" class="logo"> <span class="site-name can-hide">FluentCRM Developers</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database" class="dropdown-title"><span class="title">Database</span> <span class="arrow down"></span></button> <button type="button" aria-label="Database" class="mobile-dropdown-title"><span class="title">Database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/" class="nav-link router-link-active">
  Database Schema
</a></li><li class="dropdown-item"><!----> <a href="/database/models/" class="nav-link">
  Database Models
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Developer Hooks" class="dropdown-title"><span class="title">Developer Hooks</span> <span class="arrow down"></span></button> <button type="button" aria-label="Developer Hooks" class="mobile-dropdown-title"><span class="title">Developer Hooks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hooks/actions/" class="nav-link">
  Action Hooks
</a></li><li class="dropdown-item"><!----> <a href="/hooks/filters/" class="nav-link">
  Filter Hooks
</a></li><li class="dropdown-item"><!----> <a href="/global-functions/" class="nav-link">
  Global Functions
</a></li><li class="dropdown-item"><!----> <a href="/helpers/" class="nav-link">
  Helpers Classes
</a></li><li class="dropdown-item"><!----> <a href="/cli/" class="nav-link">
  CLI
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Modules" class="dropdown-title"><span class="title">Modules</span> <span class="arrow down"></span></button> <button type="button" aria-label="Modules" class="mobile-dropdown-title"><span class="title">Modules</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/modules/automation/" class="nav-link">
  Automation
</a></li><li class="dropdown-item"><!----> <a href="/modules/smart-code/" class="nav-link">
  Smart Codes
</a></li><li class="dropdown-item"><!----> <a href="/modules/contact-profile-section/" class="nav-link">
  Contact's Profile
</a></li><li class="dropdown-item"><!----> <a href="/extending-rest-api/" class="nav-link">
  Extending REST API
</a></li></ul></div></div><div class="nav-item"><a href="https://fluentcrm.com/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://rest-api.fluentcrm.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  REST API
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/fluentcrm/fluent-crm-developers-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/getting-started/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database" class="dropdown-title"><span class="title">Database</span> <span class="arrow down"></span></button> <button type="button" aria-label="Database" class="mobile-dropdown-title"><span class="title">Database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/" class="nav-link router-link-active">
  Database Schema
</a></li><li class="dropdown-item"><!----> <a href="/database/models/" class="nav-link">
  Database Models
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Developer Hooks" class="dropdown-title"><span class="title">Developer Hooks</span> <span class="arrow down"></span></button> <button type="button" aria-label="Developer Hooks" class="mobile-dropdown-title"><span class="title">Developer Hooks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hooks/actions/" class="nav-link">
  Action Hooks
</a></li><li class="dropdown-item"><!----> <a href="/hooks/filters/" class="nav-link">
  Filter Hooks
</a></li><li class="dropdown-item"><!----> <a href="/global-functions/" class="nav-link">
  Global Functions
</a></li><li class="dropdown-item"><!----> <a href="/helpers/" class="nav-link">
  Helpers Classes
</a></li><li class="dropdown-item"><!----> <a href="/cli/" class="nav-link">
  CLI
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Modules" class="dropdown-title"><span class="title">Modules</span> <span class="arrow down"></span></button> <button type="button" aria-label="Modules" class="mobile-dropdown-title"><span class="title">Modules</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/modules/automation/" class="nav-link">
  Automation
</a></li><li class="dropdown-item"><!----> <a href="/modules/smart-code/" class="nav-link">
  Smart Codes
</a></li><li class="dropdown-item"><!----> <a href="/modules/contact-profile-section/" class="nav-link">
  Contact's Profile
</a></li><li class="dropdown-item"><!----> <a href="/extending-rest-api/" class="nav-link">
  Extending REST API
</a></li></ul></div></div><div class="nav-item"><a href="https://fluentcrm.com/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://rest-api.fluentcrm.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  REST API
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/fluentcrm/fluent-crm-developers-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Database Schema</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/database/models/" class="sidebar-link">Model Basic</a></li><li><a href="/database/query-builder/" class="sidebar-link">Query Builder</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Database Models</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Fluent ORM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/orm/" aria-current="page" class="active sidebar-link">Getting Started</a></li><li><a href="/database/orm/relationship/" class="sidebar-link">Relationships</a></li><li><a href="/database/orm/collections/" class="sidebar-link">Collections</a></li><li><a href="/database/orm/mutators/" class="sidebar-link">Mutators</a></li><li><a href="/database/orm/serialization/" class="sidebar-link">Serialization</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="fluent-orm-getting-started"><a href="#fluent-orm-getting-started" class="header-anchor">#</a> Fluent ORM: Getting Started</h1> <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Fluent Framework</span> <span class="badge warning" style="vertical-align:top;" data-v-15b7b770>ORM</span> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>The Fluent ORM provides a beautiful, simple ActiveRecord implementation for working with your database.
Each database table has a corresponding &quot;Model&quot; which is used to interact with that table. Models allow you to query for data in your tables, as well as insert new records into the table.</p> <p><em>Note: Fluent ORM is compatible the PHP Laravel Framework's Eloquent ORM. If you are familiar with Laravel's Eloquent ORM, you will feel right at home using the Fluent ORM.</em></p> <h2 id="defining-models"><a href="#defining-models" class="header-anchor">#</a> Defining Models</h2> <p>To get started, let's create a Fluent model. Models typically live in the <code>app/Models</code> directory, but you are free to place them anywhere that can be auto-loaded according to your <code>composer.json</code> file. All Fluent models extend <code>FluentCrm\Framework\Database\Orm\Model</code> class.</p> <h2 id="fluent-model-conventions"><a href="#fluent-model-conventions" class="header-anchor">#</a> Fluent Model Conventions</h2> <p>Now, let's look at an example <code>Customer</code> model, which we will use to retrieve and store information from our <code>customers</code> database table:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="table-names"><a href="#table-names" class="header-anchor">#</a> Table Names</h3> <p>Note that we did not tell Fluent ORM which table to use for our <code>Customer</code> model. By convention, the &quot;snake case&quot;, plural name of the class will be used as the table name unless another name is explicitly specified. So, in this case, Fluent ORM will assume the <code>Customer</code> model stores records in the <code>customers</code> table. You may specify a custom table by defining a <code>table</code> property on your model:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * The table associated with the model.
     *
     * @var string
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'fc_customers'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="primary-keys"><a href="#primary-keys" class="header-anchor">#</a> Primary Keys</h3> <p>Fluent ORM will also assume that each table has a primary key column named <code>id</code>. You may define a protected <code>$primaryKey</code> property to override this convention.
In addition, Fluent ORM assumes that the primary key is an incrementing integer value, which means that by default the primary key will be cast to an <code>int</code> automatically. If you wish to use a non-incrementing or a non-numeric primary key you must set the public <code>$incrementing</code> property on your model to <code>false</code>. If your primary key is not an integer, you should set the protected <code>$keyType</code> property on your model to <code>string</code>.</p> <h3 id="timestamps"><a href="#timestamps" class="header-anchor">#</a> Timestamps</h3> <p>By default, Fluent ORM expects <code>created_at</code> and <code>updated_at</code> columns to exist on your tables. If you do not wish to have these columns automatically managed by Fluent ORM, set the <code>$timestamps</code> property on your model to <code>false</code>:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Indicates if the model should be timestamped.
     *
     * @var bool
     */</span>
    <span class="token keyword">public</span> <span class="token variable">$timestamps</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>If you need to customize the format of your timestamps, set the <code>$dateFormat</code> property on your model. This property determines how date attributes are stored in the database, as well as their format when the model is serialized to an array or JSON:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * The storage format of the model's date columns.
     *
     * @var string
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$dateFormat</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'U'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>If you need to customize the names of the columns used to store the timestamps, you may set the <code>CREATED_AT</code> and <code>UPDATED_AT</code> constants in your model:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token constant">CREATED_AT</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'sign_date'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token constant">UPDATED_AT</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'last_update'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="database-connection"><a href="#database-connection" class="header-anchor">#</a> Database Connection</h3> <p>By default, all Fluent ORM models will use the default database connection configured for your application. If you would like to specify a different connection for the model, use the <code>$connection</code> property:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * The connection name for the model.
     *
     * @var string
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'connection-name'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="retrieving-models"><a href="#retrieving-models" class="header-anchor">#</a> Retrieving Models</h3> <p>Once you have created a model and its associated database table, you are ready to start retrieving data from your database. Think of each Fluent ORM model as a powerful <a href="/database/query-builder">query builder</a> allowing you to fluently query the database table associated with the model. For example:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token punctuation">;</span>
 
<span class="token variable">$customers</span> <span class="token operator">=</span> <span class="token class-name static-context">Customer</span><span class="token operator">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$customers</span> <span class="token keyword">as</span> <span class="token variable">$customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="adding-additional-constraints"><a href="#adding-additional-constraints" class="header-anchor">#</a> Adding Additional Constraints</h3> <p>The Fluent ORM <code>all</code> method will return all the results in the model's table. Since each Fluent ORM model serves as a <a href="/database/query-builder">query builder</a>, you may also add constraints to queries, and then use the <code>get</code> method to retrieve the results:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customers</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
               <span class="token operator">-&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'desc'</span><span class="token punctuation">)</span>
               <span class="token operator">-&gt;</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
               <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="collections"><a href="#collections" class="header-anchor">#</a> Collections</h3> <p>For Fluent ORM methods like <code>all</code> and get which retrieve multiple results, an instance of <code>FluentCrm\Framework\Database\Orm\Collection</code> will be returned. The <code>Collection</code> class provides a variety of helpful methods for working with your Fluent ORM results:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customers</span> <span class="token operator">=</span> <span class="token variable">$customers</span><span class="token operator">-&gt;</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token property">cancelled</span> <span class="token operator">==</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Of course, you may also loop over the collection like an array:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$customers</span> <span class="token keyword">as</span> <span class="token variable">$customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="chunking-results"><a href="#chunking-results" class="header-anchor">#</a> Chunking Results</h3> <p>If you need to process thousands of Fluent ORM records, use the <code>chunk</code> method. The <code>chunk</code> method will retrieve a &quot;chunk&quot; of Fluent ORM models, feeding them to a given <code>Closure</code> for processing. Using the chunk method will conserve memory when working with large result sets:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">Customer</span><span class="token operator">::</span><span class="token function">chunk</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$customers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$customers</span> <span class="token keyword">as</span> <span class="token variable">$customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The first argument passed to the method is the number of records you wish to receive per &quot;chunk&quot;. The <code>Closure</code> passed as the second argument will be called for each chunk that is retrieved from the database. A database query will be executed to retrieve each chunk of records passed to the <code>Closure</code>.</p> <h3 id="using-cursors"><a href="#using-cursors" class="header-anchor">#</a> Using Cursors</h3> <p>The <code>cursor</code> method allows you to iterate through your database records using a cursor, which will only execute a single query. When processing large amounts of data, the <code>cursor</code> method may be used to greatly reduce your memory usage:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name static-context">Customer</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'bar'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">cursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$customer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="retrieving-single-models-aggregates"><a href="#retrieving-single-models-aggregates" class="header-anchor">#</a> Retrieving Single Models / Aggregates</h2> <p>Of course, in addition to retrieving all the records for a given table, you may also retrieve single records using <code>find</code> or <code>first</code>. Instead of returning a collection of models, these methods return a single model instance.</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// Retrieve a model by its primary key...</span>
<span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Retrieve the first model matching the query constraints...</span>
<span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="not-found-exceptions"><a href="#not-found-exceptions" class="header-anchor">#</a> Not Found Exceptions</h3> <p>Sometimes you may wish to throw an exception if a model is not found. This is particularly useful in routes or controllers. The <code>findOrFail</code> and <code>firstOrFail</code> methods will retrieve the first result of the query; however, if no result is found, a <code>FluentCrm\Framework\Database\Orm\ModelNotFoundException</code> will be thrown:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">findOrFail</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">firstOrFail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="retrieving-aggregates"><a href="#retrieving-aggregates" class="header-anchor">#</a> Retrieving Aggregates</h2> <p>You may also use the <code>count</code>, <code>sum</code>, <code>max</code>, and other <a href="/database/query-builder/#aggregates">aggregate methods</a> provided by the <a href="/database/query-builder">query builder</a>. These methods return the appropriate scalar value instead of a full model instance:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$count</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token variable">$max</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="inserting-updating-models"><a href="#inserting-updating-models" class="header-anchor">#</a> Inserting &amp; Updating Models</h2> <h3 id="inserts"><a href="#inserts" class="header-anchor">#</a> Inserts</h3> <p>To create a new record in the database, create a new model instance, set attributes on the model, then call the save method:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Request<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">CustomerController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Create a new flight instance.
     *
     * @param  Request  $request
     * @return Response
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">store</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Validate the request...</span>
 
        <span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Customer</span><span class="token punctuation">;</span>
 
        <span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
 
        <span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> <span class="token variable">$customer</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>In this example, we assign the <code>name</code> parameter from the incoming HTTP request to the <code>name</code> attribute of the <code>FluentCrm\App\Models\Customer</code> model instance. When we call the <code>save</code> method, a record will be inserted into the database. The <code>created_at</code> and <code>updated_at</code> timestamps will automatically be set when the <code>save</code> method is called, so there is no need to set them manually.</p> <h3 id="updates"><a href="#updates" class="header-anchor">#</a> Updates</h3> <p>The <code>save</code> method may also be used to update models that already exist in the database. To update a model, you should retrieve it, set any attributes you wish to update, and then call the <code>save</code> method. Again, the <code>updated_at</code> timestamp will automatically be updated, so there is no need to manually set its value:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'New Flight Name'</span><span class="token punctuation">;</span>
 
<span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="mass-updates"><a href="#mass-updates" class="header-anchor">#</a> Mass Updates</h3> <p>Updates can also be performed against any number of models that match a given query. In this example, all flights that are <code>active</code> and have a <code>location</code> of <code>San Diego</code> will be marked as delayed:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'San Diego'</span><span class="token punctuation">)</span>
          <span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'status'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The <code>update</code> method expects an array of column and value pairs representing the columns that should be updated.</p> <h2 id="mass-assignment"><a href="#mass-assignment" class="header-anchor">#</a> Mass Assignment</h2> <p>You may also use the <code>create</code> method to save a new model in a single line. The inserted model instance will be returned to you from the method. However, before doing so, you will need to specify either a <code>fillable</code> or <code>guarded</code> attribute on the model, as all Fluent ORM models protect against mass-assignment by default.
A mass-assignment vulnerability occurs when a user passes an unexpected HTTP parameter through a request, and that parameter changes a column in your database you did not expect. For example, a malicious user might send an <code>is_admin</code> parameter through an HTTP request, which is then passed into your model's <code>create</code> method, allowing the user to escalate themselves to an administrator.
So, to get started, you should define which model attributes you want to make mass assignable. You may do this using the <code>$fillable</code> property on the model. For example, let's make the <code>name</code> attribute of our <code>Customer</code> model mass assignable:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * The attributes that are mass assignable.
     *
     * @var array
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$fillable</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Once we have made the attributes mass assignable, we can use the <code>create</code> method to insert a new record in the database. The <code>create</code> method returns the saved model instance:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Customer 10'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="guarding-attributes"><a href="#guarding-attributes" class="header-anchor">#</a> Guarding Attributes</h3> <p>While <code>$fillable</code> serves as a &quot;white list&quot; of attributes that should be mass assignable, you may also choose to use <code>$guarded</code>. The <code>$guarded</code> property should contain an array of attributes that you do not want to be mass assignable. All other attributes not in the array will be mass assignable. So, <code>$guarded</code> functions like a &quot;black list&quot;. Of course, you should use either <code>$fillable</code> or <code>$guarded</code> - not both. In the example below, all attributes except for price will be mass assignable:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * The attributes that are mass assignable.
     *
     * @var array
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$guarded</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'is_private'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>If you would like to make all attributes mass assignable, you may define the <code>$guarded</code> property as an empty array</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">/**
 * The attributes that aren't mass assignable.
 *
 * @var array
 */</span>
<span class="token keyword">protected</span> <span class="token variable">$guarded</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="other-creation-methods"><a href="#other-creation-methods" class="header-anchor">#</a> Other Creation Methods</h2> <h3 id="firstorcreate-firstornew"><a href="#firstorcreate-firstornew" class="header-anchor">#</a> firstOrCreate/ firstOrNew</h3> <p>There are two other methods you may use to create models by mass assigning attributes: <code>firstOrCreate</code> and <code>firstOrNew</code>. The <code>firstOrCreate</code> method will attempt to locate a database record using the given column / value pairs. If the model can not be found in the database, a record will be inserted with the attributes from the first parameter, along with those in the optional second parameter.</p> <p>The <code>firstOrNew</code> method, like <code>firstOrCreate</code> will attempt to locate a record in the database matching the given attributes. However, if a model is not found, a new model instance will be returned. Note that the model returned by <code>firstOrNew</code> has not yet been persisted to the database. You will need to call save manually to persist it:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// Retrieve customer by name, or create it if it doesn't exist...</span>
<span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">firstOrCreate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Customer 7'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Retrieve customer by name, or create it with the name and delayed attributes...</span>
<span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">firstOrCreate</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Customer 7'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'delayed'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Retrieve by name, or instantiate...</span>
<span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">firstOrNew</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Customer 7'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Retrieve by name, or instantiate with the name and delayed attributes...</span>
<span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">firstOrNew</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Customer 7'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'delayed'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="updateorcreate"><a href="#updateorcreate" class="header-anchor">#</a> updateOrCreate</h3> <p>You may also come across situations where you want to update an existing model or create a new model if none exists. Fluent ORM provides an <code>updateOrCreate</code> method to do this in one step. Like the <code>firstOrCreate</code> method, <code>updateOrCreate</code> persists the model, so there's no need to call <code>save()</code>:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// If there's a customer from Oakland to San Diego, set the price to $99.</span>
<span class="token comment">// If no matching model exists, create one.</span>
<span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">updateOrCreate</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string single-quoted-string">'departure'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Oakland'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'location'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'San Diego'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string single-quoted-string">'age'</span> <span class="token operator">=&gt;</span> <span class="token number">37</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="deleting-models"><a href="#deleting-models" class="header-anchor">#</a> Deleting Models</h2> <p>To delete a model, call the <code>delete</code> method on a model instance:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customer</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="deleting-an-existing-model-by-key"><a href="#deleting-an-existing-model-by-key" class="header-anchor">#</a> Deleting An Existing Model By Key</h3> <p>In the example above, we are retrieving the model from the database before calling the <code>delete</code> method. However, if you know the primary key of the model, you may delete the model without retrieving it. To do so, call the <code>destroy</code> method:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="deleting-models-by-query"><a href="#deleting-models-by-query" class="header-anchor">#</a> Deleting Models By Query</h3> <p>Of course, you may also run a delete statement on a set of models. In this example, we will delete all flights that are marked as inactive. Like mass updates, mass deletes will not fire any model events for the models that are deleted:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$deletedRows</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'active'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="soft-deleting"><a href="#soft-deleting" class="header-anchor">#</a> Soft Deleting</h2> <p>In addition to actually removing records from your database, Fluent Orm can also &quot;soft delete&quot; models. When models are soft deleted, they are not actually removed from your database. Instead, a deleted_at attribute is set on the model and inserted into the database. If a model has a non-null <code>deleted_at</code> value, the model has been soft deleted. To enable soft deletes for a model, use the <code>FluentCrm\Framework\Database\Orm\SoftDeletes</code> trait on the model and add the <code>deleted_at</code> column to your $dates property:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>SoftDeletes</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">SoftDeletes</span><span class="token punctuation">;</span>
 
    <span class="token comment">/**
     * The attributes that should be mutated to dates.
     *
     * @var array
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$dates</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'deleted_at'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>Now, when you call the <code>delete</code> method on the model, the <code>deleted_at</code> column will be set to the current date and time. And, when querying a model that uses soft deletes, the soft deleted models will automatically be excluded from all query results.</p> <p>To determine if a given model instance has been soft deleted, use the <code>trashed</code> method:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token function">trashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="querying-soft-deleted-models"><a href="#querying-soft-deleted-models" class="header-anchor">#</a> Querying Soft Deleted Models</h2> <h3 id="including-soft-deleted-models"><a href="#including-soft-deleted-models" class="header-anchor">#</a> Including Soft Deleted Models</h3> <p>As noted above, soft deleted models will automatically be excluded from query results. However, you may force soft deleted models to appear in a result set using the <code>withTrashed</code> method on the query:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customers</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The <code>withTrashed</code> method may also be used on a relationship query:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customers</span><span class="token operator">-&gt;</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="retrieving-only-soft-deleted-models"><a href="#retrieving-only-soft-deleted-models" class="header-anchor">#</a> Retrieving Only Soft Deleted Models</h3> <p>The <code>onlyTrashed</code> method will retrieve only soft deleted models:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customers</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">onlyTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="restoring-soft-deleted-models"><a href="#restoring-soft-deleted-models" class="header-anchor">#</a> Restoring Soft Deleted Models</h3> <p>Sometimes you may wish to &quot;un-delete&quot; a soft deleted model. To restore a soft deleted model into an active state, use the <code>restore</code> method on a model instance:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customers</span><span class="token operator">-&gt;</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>You may also use the <code>restore</code> method in a query to quickly restore multiple models. Again, like other &quot;mass&quot; operations, this will not fire any model events for the models that are restored:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token operator">-&gt;</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Like the <code>withTrashed</code> method, the restore method may also be used on relationships:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="permanently-deleting-models"><a href="#permanently-deleting-models" class="header-anchor">#</a> Permanently Deleting Models</h3> <p>Sometimes you may need to truly remove a model from your database. To permanently remove a soft deleted model from the database, use the <code>forceDelete</code> method:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// Force deleting a single model instance...</span>
<span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token function">forceDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Force deleting all related models...</span>
<span class="token variable">$customer</span><span class="token operator">-&gt;</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">forceDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="query-scopes"><a href="#query-scopes" class="header-anchor">#</a> Query Scopes</h2> <h3 id="global-scopes"><a href="#global-scopes" class="header-anchor">#</a> Global Scopes</h3> <p>Global scopes allow you to add constraints to all queries for a given model.
Writing your own global scopes can provide a convenient, easy way to make sure every query for a given model receives certain constraints.</p> <h3 id="writing-global-scopes"><a href="#writing-global-scopes" class="header-anchor">#</a> Writing Global Scopes</h3> <p>Writing a global scope is simple. Define a class that implements the <code>FluentCrm\Framework\Database\Orm\Scope</code> interface. This interface requires you to implement one method: <code>apply</code>. The <code>apply</code> method may add where constraints to the query as needed:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Scopes</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Scope</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Builder</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">AgeScope</span> <span class="token keyword">implements</span> <span class="token class-name">Scope</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Apply the scope to a given Orm query builder.
     *
     * @param  \Illuminate\Database\Orm\Builder  $builder
     * @param  \Illuminate\Database\Orm\Model  $model
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">apply</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Builder</span> <span class="token variable">$builder</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">Model</span> <span class="token variable">$model</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$builder</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="applying-global-scopes"><a href="#applying-global-scopes" class="header-anchor">#</a> Applying Global Scopes</h3> <p>To assign a global scope to a model, you should override a given model's boot method and use the <code>addGlobalScope</code> method:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Scopes<span class="token punctuation">\</span>AgeScope</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * The &quot;booting&quot; method of the model.
     *
     * @return void
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword static-context">static</span><span class="token operator">::</span><span class="token function">addGlobalScope</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AgeScope</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>After adding the scope, a query to <code>Customer::all()</code> will produce the following SQL:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token identifier"><span class="token punctuation">`</span>customers<span class="token punctuation">`</span></span> <span class="token keyword">where</span> <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token operator">&gt;</span> <span class="token number">200</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="anonymous-global-scopes"><a href="#anonymous-global-scopes" class="header-anchor">#</a> Anonymous Global Scopes</h3> <p>Orm also allows you to define global scopes using Closures, which is particularly useful for simple scopes that do not warrant a separate class:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Builder</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * The &quot;booting&quot; method of the model.
     *
     * @return void
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword static-context">static</span><span class="token operator">::</span><span class="token function">addGlobalScope</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Builder</span> <span class="token variable">$builder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$builder</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="removing-global-scopes"><a href="#removing-global-scopes" class="header-anchor">#</a> Removing Global Scopes</h3> <p>If you would like to remove a global scope for a given query, you may use the <code>withoutGlobalScope</code> method. The method accepts the class name of the global scope as its only argument:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">Customer</span><span class="token operator">::</span><span class="token function">withoutGlobalScope</span><span class="token punctuation">(</span><span class="token class-name static-context">AgeScope</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Or, if you defined the global scope using a Closure:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">Customer</span><span class="token operator">::</span><span class="token function">withoutGlobalScope</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>If you would like to remove several or even all of the global scopes, you may use the <code>withoutGlobalScopes</code> method:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// Remove all the global scopes...</span>
<span class="token class-name static-context">Customer</span><span class="token operator">::</span><span class="token function">withoutGlobalScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Remove some of global scopes...</span>
<span class="token class-name static-context">Customer</span><span class="token operator">::</span><span class="token function">withoutGlobalScopes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token class-name static-context">FirstScope</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name static-context">SecondScope</span><span class="token operator">::</span><span class="token keyword">class</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="local-scopes"><a href="#local-scopes" class="header-anchor">#</a> Local Scopes</h2> <p>Local scopes allow you to define common sets of constraints that you may easily re-use throughout your application. For example, you may need to frequently retrieve all users that are considered &quot;popular&quot;. To define a scope, prefix an Orm model method with <code>scope</code>.</p> <p>Scopes should always return a query builder instance:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Scope a query to only include popular users.
     *
     * @param \FluentCrm\Framework\Database\Orm\Builder $query
     * @return \FluentCrm\Framework\Database\Orm\Builder
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">scopePopular</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'votes'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * Scope a query to only include active users.
     *
     * @param \FluentCrm\Framework\Database\Orm\Builder $query
     * @return \FluentCrm\Framework\Database\Orm\Builder
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">scopeActive</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'active'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="utilizing-a-local-scope"><a href="#utilizing-a-local-scope" class="header-anchor">#</a> Utilizing A Local Scope</h3> <p>Once the scope has been defined, you may call the scope methods when querying the model. However, you should not include the scope prefix when calling the method. You can even chain calls to various scopes, for example:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customers</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">popular</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">active</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'created_at'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="dynamic-scopes"><a href="#dynamic-scopes" class="header-anchor">#</a> Dynamic Scopes</h3> <p>Sometimes you may wish to define a scope that accepts parameters. To get started, just add your additional parameters to your scope. Scope parameters should be defined after the <code>$query</code> parameter:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 
<span class="token keyword">namespace</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models</span><span class="token punctuation">;</span>
 
<span class="token keyword">use</span> <span class="token package">FluentCrm<span class="token punctuation">\</span>Framework<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Orm<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
 
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Customer</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * Scope a query to only include popular users.
     *
     * @param \FluentCrm\Framework\Database\Orm\Builder $query
     * @return \FluentCrm\Framework\Database\Orm\Builder
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">scopePopular</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'votes'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * Scope a query to only include active users.
     *
     * @param \FluentCrm\Framework\Database\Orm\Builder $query
     * @return \FluentCrm\Framework\Database\Orm\Builder
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">scopeHasStatus</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">,</span> <span class="token variable">$status</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$query</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'active'</span><span class="token punctuation">,</span> <span class="token variable">$status</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>Now, you may pass the parameters when calling the scope:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$customers</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context">FluentCrm<span class="token punctuation">\</span>App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Customer</span><span class="token operator">::</span><span class="token function">hasStatus</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'premium'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/fluentcrm/fluent-crm-developers-docs/edit/master/src/database/orm/index.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/23/2022, 5:03:33 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database/models/webhook/" class="prev">
        Webhook Model
      </a></span> <span class="next"><a href="/database/orm/relationship/">
        Relationships
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1cc69afb.js" defer></script><script src="/assets/js/4.50f88fe4.js" defer></script><script src="/assets/js/36.688cda3c.js" defer></script><script src="/assets/js/6.ad1ba60c.js" defer></script><script src="/assets/js/5.78087223.js" defer></script>
  </body>
</html>
